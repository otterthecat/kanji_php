<?php

class Feeds_RSS {
	protected $rssVersion = '2.0';
	protected $customElements = array ();
	protected $headers = 'Content-Type: application/xml; charset=ISO-8859-1';

	public function __construct ()
	{

		$this -> customElements['generator'] = 'Kanji Framework RSS';
		$this -> customElements['title'] = 'RSS feed generated by Kanji Framework';
		$this -> customElements['link'] = 'http://kanjicms.com';
		$this -> customElements['description'] = 'Default description generated by kanji framework';
		$this -> customElements['language'] = 'en-us';

		return $this;

	}



	public function addElement ($name, $value)
	{

		if (isset ($name) && isset ($value))
		{
			$this -> customElements[$name] = $value;

			return $this;
		}

	}



	public function getRss ($data)
	{

		return $this -> buildRss ($data);

	}



	public function exportRss (Array $data)
	{
		header ($this -> headers);

		echo $this -> buildRss ($data);

		return $this;

	}



	/* $data arugument should be a multi-dimensional array
	 * where each parent key would house an array with at least 3 values:
	 * 'title', 'link', and description
	 */

	protected function buildRss (Array $data = array ())
	{

		$rss = "<?xml version=\"1.0\"?>";
		$rss .= "<rss version=\"".$this->rssVersion."\">";
		$rss .= "<channel>";

		$rss .= $this -> buildCustomElements ();

		$rss .= $this -> buildElementsFromData ($data);

		$rss .= "</channel>";
		$rss .= "</rss>";

		return $rss;

	}



	protected function buildCustomElements ()
	{
		$elements = '';

		foreach ($this -> customElements as $element => $value)
		{

			$elements .= "<$element>$value</$element>";
		}

		return $elements;

	}



	protected function buildElementsFromData (Array $data)
	{

		$elements = '';

		foreach ($data as $segment)
		{
			$elements .= '<item>';

			foreach($segment as $key => $value)
			{

				$elements .= "<$key>$value</$key>";
			}

			$elements .= "</item>";
		}

		return $elements;

	}



}

/* end class
 */